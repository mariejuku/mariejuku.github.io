jQuery.Vector=function(){if(arguments.length==0)var v=[];else if(arguments.length==1){var v=[];for(var i=0;i<arguments[0];++i){v[i]=0;}}else
var v=jQuery.makeArray(arguments);v.copy=function(){var v2=new $.Vector();$(v).each(function(i){v2[i]=v[i]});return v2;};v.isNull=function(){for(var i in v){if(v[i]!=0)return false;}return true;};v.add=function(v2){var v3=v.copy();if(v2.isNull())return v3;if(v.isNull())return v2.copy();$(v).each(function(i){v3[i]+=v2[i]});return v3;};v.sub=function(v2){var v3=v.copy();if(v2.isNull())return v3;if(v.isNull())return v2.copy();$(v).each(function(i){v3[i]-=v2[i]});return v3;};v.mul=function(x){if(x==0)return new $.Vector(v.length);var v2=v.copy();if(x==1)return v2;$(v).each(function(i){v2[i]*=x});return v2;};v.div=function(x){if(x==0)return null;return v.mul(1/x);};v.max=function(v2){var v3=v.copy();$(v).each(function(i){v3[i]=Math.max(v[i],v2[i])});return v3;};v.min=function(v2){var v3=v.copy();$(v).each(function(i){v3[i]=Math.min(v[i],v2[i])});return v3;};v.bound=function(min,max){return v.min(max).max(min);};return v;};jQuery.fn.physics=function(params){this.each(function(i){if(!this.position){if(!params.position)this.position=new $.Vector(0,0);if(!params.velocity)this.velocity=new $.Vector(0,0);if(!params.acceleration)this.acceleration=new $.Vector(0,0);if(!params.minPosition)this.minPosition=new $.Vector(-Infinity,-Infinity);if(!params.maxPosition)this.maxPosition=new $.Vector(Infinity,Infinity);if(!params.minVelocity)this.minVelocity=new $.Vector(-Infinity,-Infinity);if(!params.maxVelocity)this.maxVelocity=new $.Vector(Infinity,Infinity);if(!params.minAcceleration)this.minAcceleration=new $.Vector(-Infinity,-Infinity);if(!params.maxAcceleration)this.maxAcceleration=new $.Vector(Infinity,Infinity);if(!params.mass)this.mass=1;this.style.position='absolute';}if(params.position)this.position=params.position;if(params.velocity)this.velocity=params.velocity;if(params.acceleration)this.acceleration=params.acceleration;if(params.minPosition)this.minPosition=params.minPosition;if(params.maxPosition)this.maxPosition=params.maxPosition;if(params.minVelocity)this.minVelocity=params.minVelocity;if(params.maxVelocity)this.maxVelocity=params.maxVelocity;if(params.minAcceleration)this.minAcceleration=params.minAcceleration;if(params.maxAcceleration)this.maxAcceleration=params.maxAcceleration;if(params.mass)this.mass=params.mass;this.style.left=Math.round(this.position[0])+'px';this.style.top=Math.round(this.position[1])+'px';});return this;};jQuery.fn.applyForces=function(){if(arguments.length==1&&arguments[0].length&&!arguments[0].add)var forces=arguments[0];else
var forces=$.makeArray(arguments);if(forces.length==0)return this;var result_force=new $.Vector(forces[0].length);$(forces).each(function(){result_force=result_force.add(this);});this.each(function(){if(this.mass!=0)this.acceleration=result_force.div(this.mass).bound(this.minAcceleration,this.maxAcceleration);});return this;};jQuery.fn.updatePhysics=function(time){if(!time)time=1;var updatePhysicsCSS=function(element){var elm=$(element);var oldx=elm.css('left');var oldy=elm.css('top');var newx=Math.round(element.position[0])+'px';var newy=Math.round(element.position[1])+'px';var obj={};if(oldx!=newx)obj.left=newx;if(oldy!=newy)obj.top=newy;if(obj.left||obj.top)$(element).css(obj);return element;};var halfTime=time*0.5;this.each(function(i){var old_velocity=this.velocity.copy();this.velocity=this.velocity.add(this.acceleration.mul(time)).bound(this.minVelocity,this.maxVelocity);this.position=this.position.add(this.velocity.add(old_velocity).mul(halfTime)).bound(this.minPosition,this.maxPosition);updatePhysicsCSS(this);});return this;};